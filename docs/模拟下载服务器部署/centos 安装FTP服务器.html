<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601748 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="3778"/>

<div>
<span><div>centos  安装FTP服务器</div><div><span style="font-weight: bold;"><br/></span></div><div><span style="font-weight: bold;">FTP 服务：</span></div><div>vsftpd安装与配置      <a href="https://blog.csdn.net/qq_36938617/article/details/89077845">https://blog.csdn.net/qq_36938617/article/details/89077845</a></div><div><br/></div><div>vsftpd是“very secure TTP daemon”的缩写，是一个完全免费的、开放源代码的ftp服务器软件，是一款在Linux发行版中最受推崇的ftp服务器程序，小巧轻快，安全易用，支持虚拟用户，支持带宽限制等功能</div><div><br/></div><div>3、<span style="font-weight: bold;">安装</span></div><div>检查Linux系统是否安装了vsftpd的命令：rpm -qa|grep vsftpd</div><div>卸载vsftpd的命令yum remove vsftpd</div><div>执行yum -y install vsftpd</div><div>[root@localhost ~]# <span style="font-weight: bold;">yum -y install vsftpd</span></div><div><br/></div><div>使用whereis vsftpd 查看安装路径</div><div>[root@localhost ~]#whereis vsftpd</div><div>yum安装vsftpd的默认配置文件在/etc/vsftpd/vsftpd.conf</div><div><br/></div><div>4、<span style="font-weight: bold;">创建虚拟用户</span></div><div>（1）选择<span style="font-weight: bold;">在根目录或用户目录下创建ftp文件目录：mkdir ftpfile,如/ftpfile,</span></div><div>[root@localhost ~]# cd /</div><div>[root@localhost /]# mkdir ftpfile</div><div>[root@localhost /]# ls</div><div><img src="https://img-blog.csdnimg.cn/20190408000143797.png"></img></div><div>通过ftp上传时就会传到这个文件夹下</div><div><br/></div><div>（2）添加匿名用户：<span style="font-weight: bold;">useradd ftpuser -d /ftpfile/ -s /sbin/nologin</span>      #添加用户没有登录机器的权限,只有上传ftpfile有权限.</div><div>[root@localhost ftpfile]# useradd ftpuser -d /ftpfile/ -s /sbin/nologin</div><div><br/></div><div>（3）修改ftpfile权限：<span style="font-weight: bold;">chown -R ftpuser.ftpuser /ftpfile/</span> #把创建的用户和创建的文件夹的权限对应上。-R表示遍历，把用户或者用户组赋予到/ftpfile这个文件夹的权限上</div><div>[root@localhost ftpfile]# chown -R ftpuser.ftpuser /ftpfile/</div><div><br/></div><div>（4）重设ftpuser密码：<span style="font-weight: bold;">passwd ftpuser 123456</span>（这里设置的密码为123456）</div><div>[root@localhost /]# passwd ftpuser</div><div><br/></div><div>5、<span style="font-weight: bold;">vsftpd服务器的配置</span></div><div>（1）vsftpd.conf文件</div><div>查看ftp服务器的安装路径</div><div>[root@localhost ftpfile]# whereis vsftpd</div><div>进入/etc/vsftpd/目录下</div><div>[root@localhost ftpfile]# cd /etc/vsftpd/</div><div><img src="https://img-blog.csdnimg.cn/20190408000143909.png"></img></div><div>编辑vsftpd.conf文件，把创建的用户配置上</div><div>修改客户端登录，提示的欢迎信息（vi打开文件输入/然后将banner输入，再点击enter键，能快速找到banner信息）</div><div><img src="https://img-blog.csdnimg.cn/20190408000144828.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2OTM4NjE3,size_16,color_FFFFFF,t_70"></img></div><div>需要将注释取消掉，改为自己想要的提示信息</div><div><br/></div><div>还需要添加一些重要的属性节点</div><div>local_root=/ftpfile                      #把本地账户指向创建的ftpfile文件夹</div><div>anon_root=/ftpfile            #添加匿名账户访问ftpfile目录</div><div>use_localtime=YES            #ftp服务器用到的是本地的时间</div><div><img src="https://img-blog.csdnimg.cn/201904080001449.png"></img></div><div><br/></div><div>查找chroot_list节点</div><div><img src="https://img-blog.csdnimg.cn/2019040800014420.png"></img></div><div><br/></div><div>#chroot_local_user=YES                    #这个节点为是否锁定创建的/ftpfile为根目录,不解除注释，默认为chroot_local_user=NO，锁定创建的/ftpfile为根目录，如果解除后设置为chroot_local_user=YES，那么就没有锁定创建的/ftpfile为根目录，在命令行是可以访问到/ftpfile的上级目录，也就是系统的根目录，这是绝对不安全的。所以这个节点不用解除注释，或者解除更改为chroot_local_user=NO。</div><div>编辑该节点，解除</div><div>chroot_list_enable=YES</div><div>chroot_list_file=/etc/vsftpd/chroot_list</div><div><br/></div><div>添加节点</div><div>allow_writeable_chroot=YES                     #加上这行解决了无法登陆的问题</div><div>两条命令的注释，将新建的用户添上。</div><div><img src="https://img-blog.csdnimg.cn/20190408000144793.png"></img></div><div>查找节点anonymous_enable</div><div><img src="https://img-blog.csdnimg.cn/20190408000144715.png"></img></div><div>将该节点改为anonymous_enable=NO，不允许匿名用户登录</div><div><img src="https://img-blog.csdnimg.cn/20190408000535450.png"></img></div><div>在该文件的末尾添加传输接口的范围，最大接口61001，最大接口62000，限定严格的设置防火墙。</div><div><img src="centos 安装FTP服务器_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>添加范围</div><div>pasv_min_port=61001</div><div>pasv_max_port=62000</div><div><img src="centos 安装FTP服务器_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>编辑完成保存退出。</div><div><br/></div><div>（2）配置chroot_list文件</div><div>该文件目录的节点在上一步配置vsftpd.conf文件中已解除注释。</div><div>进入到/etc/vsftpd/目录下创建文件chroot_list</div><div>[root@localhost vsftpd]# cd /etc/vsftpd/</div><div>[root@localhost vsftpd]# vi chroot_list                  </div><div>#用编辑器打开文件时，如果没有这个文件，会默认自动创建一个该文件。</div><div>将用户添加进入该新建的chroot_list文件中</div><div><img src="centos 安装FTP服务器_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>保存退出。</div><div><br/></div><div>（5）编辑文件/etc/selinux/config文件</div><div><br/></div><div>[root@localhost vsftpd]# vi /etc/selinux/config</div><div><img src="centos 安装FTP服务器_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>修改为SELINUX=disabled，如果不改的话，匿名账户无法创建文件文件或者文件目录</div><div><img src="centos 安装FTP服务器_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>:wq保存退出</div><div>注：如果在验证的时候碰到550拒绝访问请执行：</div><div>sudo setsebool -P ftp_home_dir 1</div><div>然后重启Linux服务器，执行reboot命令。</div><div><br/></div><div>6、vsftpd配置文件说明</div><div>sudo vi /etc/vsftpd/vsftpd.conf</div><div>vsftpd.conf文件的配置文件的添加或更新配置</div><div><br/></div><div>本项目要用到的配置项：</div><div>1）local_root=/ftpfile(当本地用户登入时，将被更换到定义的目录下，默认值为各用户的家目录)</div><div>2）anon_root=/ftpfile(使用匿名登入时，所登入的目录)</div><div>3）use_localtime=YES(默认是GMT时间，改成使用本机系统时间)</div><div>4）anonymous_enable=NO(不允许匿名用户登录)</div><div>5）local_enable=YES(允许本地用户登录)</div><div>6）write_enable=YES(本地用户可以在自己家目录中进行读写操作)</div><div>7）local_umask=022(本地用户新增档案时的umask值)</div><div>8）dirmessage_enable=YES(如果启动这个选项，那么使用者第一次进入一个目录时，会检查该目录下是否有.message这个档案，如果有，则会出现此档案的内容，通常这个档案会放置欢迎话语，或是对该目录的说明。默认值为开启)</div><div>9）xferlog_enable=YES(是否启用上传/下载日志记录。如果启用，则上传与下载的信息将被完整纪录在xferlog_file 所定义的档案中。预设为开启。)</div><div>10）connect_from_port_20=YES(指定FTP使用20端口进行数据传输，默认值为YES)</div><div>11）xferlog_std_format=YES(如果启用，则日志文件将会写成xferlog的标准格式)</div><div>12）ftpd_banner=Welcome to mmall FTP Server(这里用来定义欢迎话语的字符串)</div><div>13）chroot_local_user=NO(用于指定用户列表文件中的用户是否允许切换到上级目录)</div><div>14）chroot_list_enable=YES(设置是否启用chroot_list_file配置项指定的用户列表文件)</div><div>15）chroot_list_file=/etc/vsftpd/chroot_list(用于指定用户列表文件)</div><div>16）listen=YES(设置vsftpd服务器是否以standalone模式运行，以standalone模式运行是一种较好的方式，此时listen必须设置为YES，此为默认值。建议不要更改，有很多与服务器运行相关的配置命令，需要在此模式下才有效，若设置为NO，则vsftpd不是以独立的服务运行，要受到xinetd服务的管控，功能上会受到限制)</div><div>17）pam_service_name=vsftpd(虚拟用户使用PAM认证方式，这里是设置PAM使用的名称，默认即可，与/etc/pam.d/vsftpd对应) userlist_enable=YES(是否启用vsftpd.user_list文件，黑名单,白名单都可以</div><div>18)pasv_min_port=61001(被动模式使用端口范围最小值)</div><div>19)pasv_max_port=62000(被动模式使用端口范围最大值)</div><div>20)pasv_enable=YES(pasv_enable=YES/NO（YES）</div><div><br/></div><div>若设置为YES，则使用PASV工作模式；若设置为NO，则使用PORT模式。默认值为YES，即使用PASV工作模式。</div><div><br/></div><div>   FTP协议有两种工作方式：PORT方式和PASV方式，中文意思为主动式和被动式。</div><div>   一、PORT（主动）方式的连接过程是：客户端向服务器的FTP端口（默认是21）发送连接请求，服务器接受连接，建立一条命令链路。</div><div>  当需要传送数据时，客户端在命令链路上用 PORT命令告诉服务器：“我打开了****端口，你过来连接我”。于是服务器从20端口向客户端的****端口发送连接请求，建立一条数据链路来传送数据。</div><div>   二、PASV（被动）方式的连接过程是：客户端向服务器的FTP端口（默认是21）发送连接请求，服务器接受连接，建立一条命令链路。</div><div>  当需要传送数据时，服务器在命令链路上用 PASV命令告诉客户端：“我打开了****端口，你过来连接我”。于是客户端向服务器的****端口发送连接请求，建立一条数据链路来传送数据。</div><div>  从上面可以看出，两种方式的命令链路连接方法是一样的，而数据链路的建立方法就完全不同。而FTP的复杂性就在于此。</div><div>)</div><div><br/></div><div>7、防火墙的配置</div><div>防火墙的配置（这里采用的是centos6，用的还是Iptables文件设置防火墙）</div><div>（1）编辑防火墙文件</div><div>sudo vi /etc/sysconfig/iptables</div><div>（2）添加防火墙规则到配置文件中</div><div>-A INPUT -p TCP --dport 61001:62000 -j ACCEPT</div><div>-A OUTPUT -p TCP --sport 61001:62000 -j ACCEPT</div><div>-A INPUT -p TCP --dport 20 -j ACCEPT</div><div>-A OUTPUT -p TCP --sport 20 -j ACCEPT</div><div>-A INPUT -p TCP --dport 21 -j ACCEPT</div><div>-A OUTPUT -p TCP --sport 21 -j ACCEPT</div><div>（3）:wq保存退出</div><div>（4）sudo service iptables restart 执行命令重启防火墙</div><div><br/></div><div>8、vsftpd的验证</div><div>（1）执行sudo <span style="font-weight: bold;">service vsftpd restart</span></div><div>[root@localhost vsftpd]# service vsftpd restart</div><div>注：第一次启动时Shutting down vsftpd是failed不用理会，因为这是重启命令，保证Starting vsftpd for vsftpd是OK即代表vsftpd服务成功。、</div><div><span style="font-weight: bold;">service vsftpd stop</span>            #表示关闭vsftpd</div><div><br/></div><div>（2）执行ifconfig查看运行vsftpd服务器的ip地址</div><div>（3）打开浏览器访问：<a href="ftp://192.168.244.128/">ftp://192.168.244.128/</a></div><div><img src="centos 安装FTP服务器_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div>（4）输入之前创建的ftp匿名用户账号和密码</div><div>例如：用户名：ftpuser,密码：123456</div><div><br/></div><div><br/></div><div>9、vsftpd的常用命令</div><div><span style="font-weight: bold;">（1）启动：sudo service vsftpd start</span></div><div><span style="font-weight: bold;">（2）关闭：sudo service vsftpd stop</span></div><div><span style="font-weight: bold;">（3）重启：sudo service vsftpd restart</span></div><div><br/></div><div><br/></div></span>
</div></body></html> 